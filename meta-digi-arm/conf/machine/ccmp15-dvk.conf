#@TYPE: Machine
#@NAME: ccmp15-dvk
#@DESCRIPTION: Configuration for Digi ConnectCore MP15 DVK
#@NEEDED_BSPLAYERS: layers/meta-digi

include conf/machine/include/st-machine-common-stm32mp.inc
include conf/machine/include/tune-cortexa7.inc
include conf/machine/include/digi-defaults.inc

# =========================================================================
# Chip architecture
# =========================================================================
DEFAULTTUNE = "cortexa7thf-neon-vfpv4"
MACHINEOVERRIDES = "arm:armv7ve:stcommon:stm32mpcommon:ccmp1:ccmp15:ccmp15-dvk"

# =========================================================================
# U-Boot configs
# =========================================================================
UBOOT_CONFIG = "ccmp15_trusted_defconfig,,u-boot-dtb.${UBOOT_SUFFIX}"

# =========================================================================
# Machine settings
# =========================================================================
# Define list of devicetree per board

# Extra DTB for board - need to specify it with .dtb ...
STM32MP_KERNEL_DEVICETREE_ccmp15-dvk += "ccmp157-dvk.dtb"
STM32MP_KERNEL_DEVICETREE_ccmp15-dvk += "ccmp151-dvk.dtb"

# =========================================================================
# Machine features
# =========================================================================
MACHINE_FEATURES += "bluetooth"
MACHINE_FEATURES += "wifi"
MACHINE_FEATURES += "gpu"
MACHINE_FEATURES += "mca"

# =========================================================================
# Firmware
# =========================================================================
MACHINE_FIRMWARE_append = " firmware-murata firmware-murata-mfgtest"

MACHINE_EXTRA_RRECOMMENDS += " \
    ${MACHINE_FIRMWARE} \
"

# =========================================================================
# Image
# =========================================================================
# Image FS types
IMAGE_FSTYPES += '${@bb.utils.contains("IMAGE_FEATURES", "read-only-rootfs", \
                                       "tar.bz2 boot.ubifs recovery.ubifs squashfs", \
                                       "tar.bz2 ubifs boot.ubifs recovery.ubifs", d)}'

# =========================================================================
# flashlayout
# =========================================================================
# Define the config labels to use to generate flashlayout file

# =========================================================================
# extlinux configuration
# =========================================================================
# As example, modify the default boot config for each target to M4 config

# =========================================================================
# Trusted firmware debug
# =========================================================================
TF_DEBUG ?= "0"

# =========================================================================
# Flashlayouts
# =========================================================================

# =========================================================================
# Kernel
# =========================================================================
KERNEL_IMAGETYPE = "zImage"
KERNEL_ALT_IMAGETYPE = "Image uImage vmlinux"
KERNEL_DEFCONFIG ?= "ccmp15_defconfig"
ST_KERNEL_LOADADDR ?= "0xC0008000"

# =========================================================================
# DEY settings
# =========================================================================
IMAGE_CLASSES = "image_types_digi image_types-stubi"

# U-Boot environment offset (within partition)
UBOOT_ENV_OFFSET ?= "0x0"
# U-Boot environment size
UBOOT_ENV_SIZE ?= "0x20000"
# U-Boot environment range: size (in hex) in the environment partition that
# the U-Boot environment can take up (if undefined, it will take up all the
# available space in the environment partition)
UBOOT_ENV_RANGE ?= ""

STORAGE_MEDIA = "mtd"

# Enable STM specific features
DEY_BUILD_PLATFORM = "STM"

# Wireless external module
HAS_WIFI_VIRTWLANS = "true"

# Remove additional bluetooth packages
MACHINE_BLUETOOTH_EXTRA_INSTALL = ""

# =========================================================================
# alsa
# =========================================================================
ALSA_LIST = ""
