#
# U-Boot bootscript for altbootcmd (boot fallback after N failed boot retries)
#

# U-Boot tries to boot the active system for a number of tries. If the limit
# is reached, altbootcmd is run instead. This is the script that it will run.
# It has to:
#  * switch active partitions bank in case of dual boot systems
#  * reset the 'bootcount' number
#  * reboot the system

if test "${dualboot}" = "yes"; then
	if test "${active_system}" = "linux_a"; then
		setenv active_system linux_b
		setenv mtdbootpart ${active_system}
		setenv rootfsvol ${rootfsvol_b}
	else
		setenv active_system linux_a
		setenv mtdbootpart ${active_system}
		setenv rootfsvol ${rootfsvol_a}
	fi
	saveenv
	echo "## System boot failed; Switching active partitions bank to ${active_system}..."
fi
bootcount reset
reset
